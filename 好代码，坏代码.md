第1章 代码质量

第2章 抽象层次、

1、函数

​	编写短小精悍、重点集中的函数，是确保代码可读性和可重用性的方法之一。在艰苦的编程工作中，很容易最终编写出非常长且不容易理解的函数。因此，在写出第一批代码并送去代码评审之前，应该以挑剔的眼光再看看。当我们看到一个函数难以翻译成一个句子时，就应该考虑将其各部分逻辑分解为具有合适名称的助手函数。

2、类

编写易于理解的代码

编写模块化的代码

编写可重用、可推广的代码

编写可测试的代码并适当测试

3、接口

公共API变得非常清晰

我们对只需要一个实现的假设可能是错误的

测试更加简便

同一个类可以解决两个子问题

工作量略大

代码可能变得更加复杂[]

4、小结

将代码分解为清晰、明确的抽象层次，可使之具有更好的可读性、模块性、可重用性、可推广性和可测试性。

我们可以使用函数、类和接口（以及其他编程语言相关特性）将代码分解为不同的抽象层次。

确定如何将代码吗分解为抽象层次，需要运用我们的判断力和对需要解决的问题的认识。

层次过厚引发的问题通常比层次过薄引发的问题更严重。如果我们不能确定，最好的办法往往是偏向于薄的层次。



第4章 错误

系统可恢复和不可恢复错误之间的区别

快速失败（failing fast）和大声失败（failing loudly）；

报告错误的不同技术与选用时的考虑因素

4.2 鲁棒性与故障

错误发生时，往往有如下两种选择：

失败，可能由高层次代码处理错误，或者使整个程序崩溃。

试图处理错误并继续执行。

继续执行有些时候可以使代码更加鲁棒，但也意味着错误没有引起注意，并开始出现奇怪的现象。

快速失败

大声失败

可恢复性范围

不要隐藏错误：例如不要返回默认值，不要返回空对象模式，不要什么都不做。

4.3 错误报告方式

显示报告：受检异常，继承Exception,并在函数声明抛出的异常

隐式报告：非受检异常，继承RuntimeException,不用再函数声明抛出的异常jh

第5章 编写易于理解的代码

使代码不言自明的技术

确保代码中的细节对其他人来说使清晰的

以正当理由使用语言特性

5.1 使用描述性的名称

5.2 适当使用注释

解释代码完成的是什么

解释代码为什么完成这些工作

提供其他信息，如使用指南

5.2.1多余的注释可能有害

5.2.2 注释不是可读代码的合格替代品

5.2.3 注释可能很适合于解释代码存/、在的理由

5.2.4 注释可以提供有用的高层概述（例如在类上说明）

5.3 不要执着于代码行数

5.4 坚持一致的编码风格

5.5 避免深嵌套代码

5.6 使函数调用易于理解

5.7 避免使用未做解释的值

5.8 正确使用匿名函数

5.9 正确使用新奇的编程语言特性

第6章 避免意外

代码如何避免意外

意外可能以何种方式导致软件存在缺陷

确保代码不会造成意外的方法

6.1 避免返回魔法值

6.2 正确使用空对象模式

6.3 避免造成意料之外的副作用

当副作用无法避免时，恰当的命名是使其显而易见的有效手段

6.4 谨防输入参数突变

6.5 避免编写误导性的函数

6.6 永不过时的枚举处理

6.7 我们不能只用测试解决所有此类问题吗

第7章 编写难以被误用的代码

代码误用是如何导致程序缺陷的

代码易被误用的常见方式

编写难以被误用的代码的技术

7.1 考虑不可变对象（final）

7.2 考虑深度不可变（使用不可变的数据结构）

7.3 避免过于通用的类型

有时候使用非常通用的现成数据类型似乎是代表某种事物的快捷方式。但当我们需要表示某个特定的事物时，额外花一点精力定义专用类型往往更好。从中长期看，这通常能节约时间，因为代码的功能变得更加显而易见，也更难以被误用。

7.4 处理时间

7.5 拥有单一可信数据源

7.6 拥有单一可信逻辑来源

第8章 实现代码模块化

模块化代码的好处

代码模块化程度不理想的常见形式

如何提高代码模块化程度

8.1 考虑使用依赖注入

8.2 倾向于依赖接口

8.3 注意类的继承

8.4 类应该只关心自身

8.5 将相关联的数据封装在一起

8.6 防止在返回类型中泄露实现细节

8.7 防止在异常中泄露实现细节

第9章 编写可重用、可推广的代码

如何编写可安全重用的代码

如何编写可推广以解决不同问题的代码

9.1 注意各种假设

9.2 注意全局状态

9.3 恰当地使用默认返回值

9.4 保持函数参数的集中度

9.5 考虑使用泛型

第10章 单元测试原则

单元测试基础知识

如何造就好的单元测试

测试替身的概念，包括使用的时机和方法

测试思想

10.1 单元测试入门

10.2 是什么造就好的单元测试

10.3 专注于公共API，但不要忽略重要的行为

10.4 测试替身（模拟对象和桩）

10.5 挑选测试思想

第11章 单元测试实践

11.1 测试行为，而不仅仅是函数

11.2 避免仅为了测试而使所有细节可见 

11.3 一次测试一个行为

11.4 恰当地使用共享测试配置

11.5 使用合适的断言匹配器

11.6 使用依赖注入来提高可测试性





第10、11章主要介绍了单元测试的一些基本概念，一些思想，同时通过实战来说明，单元测试主要测试的是行为，而不是具体的函数。避免仅为了测试而使所有细节可见。一次测试最好只测试一个行为。对于共享状态、数据的一些介绍。同时使用合适的断言匹配器的重要性，代码最好不要通过硬编码，应使用依赖注入来提高可测试性。

